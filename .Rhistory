group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = ggptt::line_wrap(aluetyyppi, 25)) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = vars)) +
facet_wrap( ~ aluetyyppi) +
geom_line() +
geom_h0() +
# scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden ja 18-80-vuotiaiden nettomuutto vuosina {time_range[1]}-{time_range[2]}."),
title = "Työperäinen nettomuutto",
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
time_range[1]
time_range <- range(tyo_muutto_atyyppi$time)
dat_muuttotiedot_kunnittain %>%
rename(time = "Vuosi") %>%
filter(Tiedot == "nettomuutto",
time >= time_range[1]) %>%
group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = fct_rev(ggptt::line_wrap(aluetyyppi, 25))) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = vars)) +
facet_wrap( ~ aluetyyppi) +
geom_line() +
geom_h0() +
# scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden ja 18-80-vuotiaiden nettomuutto vuosina {time_range[1]}-{time_range[2]}."),
title = "Työperäinen nettomuutto",
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
View(aluetyyppi)
tyo_muutto_atyyppi <- read.csv2("data-raw/muutto_atyyppi_ulos.csv") %>%
mutate(aluetyyppi = factor(atyyppi,
c("pk", "yokaup", "tkakeskus", "kaup", "kaupms", "ydinms", "ms"),
c("PK-seutu", "Muut yliopistokaupungit", "Muut työssäkäyntialueiden keskukset",
"Muut kaupungit", "Kaupunkien läh. maaseutu",
"Ydinmaaseutu", "Harvaan asuttu maaseutu"))) %>%
mutate(tyo_muutto_netto = tyo_muutto_tulo - tyo_muutto_lahto,
tyopaikki_muutto_netto = tyopaikka_muutto_tulo - tyopaikka_muutto_lahto,
tyollistyy_muutto_netto = tyollistyy_muutto_tulo - tyollistyy_muutto_lahto,
tmuutto_netto = amuutto_tulo - amuutto_lahto) %>%
rename(time = vuosi,
tmuutto_tulo = amuutto_tulo,
tmuutto_lahto = amuutto_lahto) %>%
select(-atyyppi)
tyo_muutto_ku <- read.csv2("data-raw/muutto_ku_ulos.csv")
use_data(tyo_muutto_atyyppi, tyo_muutto_ku, overwrite = TRUE)
time_range <- range(tyo_muutto_atyyppi$time)
dat_muuttotiedot_kunnittain %>%
rename(time = "Vuosi") %>%
filter(Tiedot == "nettomuutto",
time >= time_range[1]) %>%
group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = fct_rev(ggptt::line_wrap(aluetyyppi, 25))) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = vars)) +
facet_wrap( ~ aluetyyppi) +
geom_line() +
geom_h0() +
# scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden ja 18-80-vuotiaiden nettomuutto vuosina {time_range[1]}-{time_range[2]}."),
title = "Työperäinen nettomuutto",
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
time_range <- range(tyo_muutto_atyyppi$time)
dat_muuttotiedot_kunnittain %>%
rename(time = "Vuosi") %>%
filter(Tiedot == "nettomuutto",
time >= time_range[1]) %>%
group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = fct_rev(ggptt::line_wrap(aluetyyppi, 25))) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = vars)) +
facet_wrap( ~ aluetyyppi) +
geom_line() +
geom_h0() +
# scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden ja 18-80-vuotiaiden nettomuutto vuosina {time_range[1]}-{time_range[2]}."),
title = "Työperäinen nettomuutto",
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
aluetyyppi <- readxl::read_xls("data-raw/msindaluejaot10.xls") %>%
mutate(kunta_no = as_factor(statfitools::extract_code(Kunta, numbers_as_numeric = FALSE)),
kunta = as_factor(statfitools::extract_name(Kunta)),
aluetyyppi = coalesce(luokka2, Alueluokka)) %>%
select(kunta_no, kunta, aluetyyppi) %>%
mutate(aluetyyppi = fct_relevel(aluetyyppi,
rev(c("Harvaan asuttu maaseutu", "Ydinmaaseutu", "Kaupunkien läh. maaseutu",
"Kaupungit", "TKA", "YO", "PK seutu")))) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muut kaupungit' = "Kaupungit",
'Muut työssäkäyntialueiden keskukset' = "TKA",
'Muut yliopistokaupungit' = "YO",
'PK-seutu' = "PK seutu"))
use_data(aluetyyppi, overwrite = TRUE)
dat_muuttotiedot_kunnittain <-
get_pxweb_data(url = "http://pxnet2.stat.fi/PXWeb/api/v1/fi/StatFin/vrm/muutl/statfin_muutl_pxt_11a2.px",
dims = list(Alue = c('020', '005', '009', '010', '016', '018', '019', '035', '043', '046', '047', '049', '050', '051', '052', '060', '061', '062', '065', '069', '071', '072', '074', '075', '076', '077', '078', '079', '081', '082', '086', '111', '090', '091', '097', '098', '099', '102', '103', '105', '106', '108', '109', '139', '140', '142', '143', '145', '146', '153', '148', '149', '151', '152', '165', '167', '169', '170', '171', '172', '176', '177', '178', '179', '181', '182', '186', '202', '204', '205', '208', '211', '213', '214', '216', '217', '218', '224', '226', '230', '231', '232', '233', '235', '236', '239', '240', '320', '241', '322', '244', '245', '249', '250', '256', '257', '260', '261', '263', '265', '271', '272', '273', '275', '276', '280', '284', '285', '286', '287', '288', '290', '291', '295', '297', '300', '301', '304', '305', '312', '316', '317', '318', '398', '399', '400', '407', '402', '403', '405', '408', '410', '416', '417', '418', '420', '421', '422', '423', '425', '426', '444', '430', '433', '434', '435', '436', '438', '440', '441', '475', '478', '480', '481', '483', '484', '489', '491', '494', '495', '498', '499', '500', '503', '504', '505', '508', '507', '529', '531', '535', '536', '538', '541', '543', '545', '560', '561', '562', '563', '564', '309', '576', '577', '578', '445', '580', '581', '599', '583', '854', '584', '588', '592', '593', '595', '598', '601', '604', '607', '608', '609', '611', '638', '614', '615', '616', '619', '620', '623', '624', '625', '626', '630', '631', '635', '636', '678', '710', '680', '681', '683', '684', '686', '687', '689', '691', '694', '697', '698', '700', '702', '704', '707', '729', '732', '734', '736', '790', '738', '739', '740', '742', '743', '746', '747', '748', '791', '749', '751', '753', '755', '758', '759', '761', '762', '765', '766', '768', '771', '777', '778', '781', '783', '831', '832', '833', '834', '837', '844', '845', '846', '848', '849', '850', '851', '853', '857', '858', '859', '886', '887', '889', '890', '892', '893', '895', '785', '905', '908', '911', '092', '915', '918', '921', '922', '924', '925', '927', '931', '934', '935', '936', '941', '946', '976', '977', '980', '981', '989', '992'),
Vuosi = c('*'),
Sukupuoli = c('SSS'),
Ikä = c('SSS'),
Tiedot = c('*')),
clean = TRUE)
# Change types of Alue and Vuosi and names in Tiedot
dat_muuttotiedot_kunnittain$Alue <- as.character(dat_muuttotiedot_kunnittain$Alue)
dat_muuttotiedot_kunnittain$Vuosi <- as.integer(as.character(dat_muuttotiedot_kunnittain$Vuosi))
levels(dat_muuttotiedot_kunnittain$Tiedot) <- c("lahtomuutto", "nettomuutto", "tulomuutto")
# Change name of Maarianhamina
dat_muuttotiedot_kunnittain$Alue[dat_muuttotiedot_kunnittain$Alue == "Maarianhamina - Mariehamn"] <- "Maarianhamina"
# Add seutukunta, maakunta and kuntaryhma to the data
dat_muuttotiedot_kunnittain <- dat_muuttotiedot_kunnittain %>%
select(-Ikä, -Sukupuoli) %>%
mutate(seutukunta = kuntaluokka(Alue, "Seutukunta")) %>%
mutate(maakunta = kuntaluokka(Alue, "Maakunta")) %>%
mutate(kuntaryhma = kuntaluokka(Alue, "Kuntaryhma"))
# Load aluetyypit and väkilukutiedot
load("data/aluetyyppi.rda")
dat_kuntien_vakiluvut <- readRDS("data/dat_kuntien_vakiluvut.rds")
# Add aluetyypit to the data
dat_muuttotiedot_kunnittain <- dat_muuttotiedot_kunnittain %>%
rename(kunta = Alue) %>%
left_join(aluetyyppi, by = "kunta")
# Add väkilukutiedot to the data
dat_muuttotiedot_kunnittain <- dat_muuttotiedot_kunnittain %>%
rename(Alue = kunta) %>%
left_join(dat_kuntien_vakiluvut, by = c("Alue", "Vuosi"))
# Compute muuttoasteet
dat_muuttotiedot_kunnittain <- dat_muuttotiedot_kunnittain %>%
spread(Tiedot, values) %>%
mutate(tulomuuttoaste = tulomuutto / vakiluku,
lahtomuuttoaste = lahtomuutto / vakiluku,
nettomuuttoaste = nettomuutto / vakiluku) %>%
gather(Tiedot, values, c("tulomuutto", "lahtomuutto", "nettomuutto",
"tulomuuttoaste", "lahtomuuttoaste", "nettomuuttoaste"))
# Save data
saveRDS(dat_muuttotiedot_kunnittain, file = "data/dat_muuttotiedot_kunnittain.rds")
use_data(dat_muuttotiedot_kunnittain, overwrite = TRUE)
time_range <- range(tyo_muutto_atyyppi$time)
dat_muuttotiedot_kunnittain %>%
rename(time = "Vuosi") %>%
filter(Tiedot == "nettomuutto",
time >= time_range[1]) %>%
group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = fct_rev(ggptt::line_wrap(aluetyyppi, 25))) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = vars)) +
facet_wrap( ~ aluetyyppi) +
geom_line() +
geom_h0() +
# scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden ja 18-80-vuotiaiden nettomuutto vuosina {time_range[1]}-{time_range[2]}."),
title = "Työperäinen nettomuutto",
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
filter(tyo_muutto_atyyppi, time == 2015)
sum(filter(tyo_muutto_atyyppi, time == 2015)$tyo_muutto_netto)
dat_muuttotiedot_kunnittain %>%
rename(time = "Vuosi") %>%
filter(Tiedot == "nettomuutto",
time >= time_range[1]) %>%
group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = fct_rev(ggptt::line_wrap(aluetyyppi, 25))) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = aluetyyppi)) +
facet_wrap( ~ vars) +
geom_line() +
geom_h0() +
# scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden ja 18-80-vuotiaiden nettomuutto vuosina {time_range[1]}-{time_range[2]}."),
title = "Työperäinen nettomuutto",
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
dat_muuttotiedot_kunnittain %>%
rename(time = "Vuosi") %>%
filter(Tiedot == "nettomuutto",
time >= time_range[1]) %>%
group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = fct_rev(ggptt::line_wrap(aluetyyppi, 25))) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = aluetyyppi)) +
facet_wrap( ~ vars) +
geom_line() +
geom_h0() +
scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden ja 18-80-vuotiaiden nettomuutto vuosina {time_range[1]}-{time_range[2]}."),
title = "Työperäinen nettomuutto",
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
dat_muuttotiedot_kunnittain %>%
rename(time = "Vuosi") %>%
filter(Tiedot == "nettomuutto",
time >= time_range[1]) %>%
group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = ggptt::line_wrap(aluetyyppi, 25)) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = aluetyyppi)) +
facet_wrap( ~ vars) +
geom_line() +
geom_h0() +
scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden ja 18-80-vuotiaiden nettomuutto vuosina {time_range[1]}-{time_range[2]}."),
title = "Työperäinen nettomuutto",
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
time_range <- range(tyo_muutto_atyyppi$time)
dat_muuttotiedot_kunnittain %>%
rename(time = "Vuosi") %>%
filter(Tiedot == "nettomuutto",
time >= time_range[1]) %>%
group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = ggptt::line_wrap(aluetyyppi, 25)) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = vars)) +
facet_wrap( ~ aluetyyppi) +
geom_line() +
geom_h0() +
# scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden ja 18-80-vuotiaiden nettomuutto vuosina {time_range[1]}-{time_range[2]}."),
title = "Työperäinen nettomuutto",
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
time_range2 <- range(dat_muuttotiedot_kunnittain$Vuosi)
time_range <- range(tyo_muutto_atyyppi$time)
time_range2 <- range(dat_muuttotiedot_kunnittain$Vuosi)
dat_muuttotiedot_kunnittain %>%
rename(time = "Vuosi") %>%
filter(Tiedot == "nettomuutto",
time >= time_range[1]) %>%
group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = ggptt::line_wrap(aluetyyppi, 25)) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = vars)) +
facet_wrap( ~ aluetyyppi) +
geom_line() +
geom_h0() +
# scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Työperäinen muutto on samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden muutto vuosina {time_range[1]}-{time_range[2]}."),
title = "Nettomuutto ja työperäinen nettomuutto",
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
dat_muuttotiedot_kunnittain %>%
rename(time = "Vuosi") %>%
filter(Tiedot == "nettomuutto",
time >= time_range[1]) %>%
group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = ggptt::line_wrap(aluetyyppi, 25)) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = vars)) +
facet_wrap( ~ aluetyyppi) +
geom_line() +
geom_h0() +
# scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Työperäinen muutto on samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden muutto vuosina {time_range[1]}-{time_range[2]}."),
title = glue("Nettomuutto ja työperäinen nettomuutto {time_range[1]}-{time_range[2]}/{time_range2[2]}"),
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
time_range <- range(tyo_muutto_atyyppi$time)
time_range2 <- range(dat_muuttotiedot_kunnittain$Vuosi)
dat_muuttotiedot_kunnittain %>%
rename(time = "Vuosi") %>%
filter(Tiedot == "nettomuutto",
time >= time_range[1]) %>%
group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = ggptt::line_wrap(aluetyyppi, 25)) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = vars)) +
facet_wrap( ~ aluetyyppi) +
geom_line() +
geom_h0() +
# scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Työperäinen muutto on samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden muutto vuosina {time_range[1]}-{time_range[2]}."),
title = glue("Nettomuutto ja työperäinen nettomuutto {time_range[1]}-{time_range[2]}/{time_range2[2]}"),
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
dat_muuttotiedot_kunnittain %>%
rename(time = "Vuosi") %>%
filter(Tiedot == "nettomuutto",
time >= time_range[1]) %>%
group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = ggptt::line_wrap(aluetyyppi, 25)) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = vars)) +
facet_wrap( ~ aluetyyppi) +
geom_line() +
geom_h0() +
# scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Työperäinen muutto on samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden muutto vuosina {time_range[1]}-{time_range[2]}."),
title = glue("Nettomuutto ja työperäinen nettomuutto {time_range[1]}-{time_range[2]}/{no_century(time_range2[2])}"),
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
dat_muuttotiedot_kunnittain %>%
rename(time = "Vuosi") %>%
filter(Tiedot == "nettomuutto",
time >= time_range[1]) %>%
group_by(time, aluetyyppi) %>%
summarise(nettomuutto = sum(values)) %>%
left_join(select(tyo_muutto_atyyppi, time, aluetyyppi, tyo_muutto_netto), by = c("time", "aluetyyppi")) %>%
rename('Työperäinen' = tyo_muutto_netto, 'Kaikki' = nettomuutto) %>%
mutate(aluetyyppi = fct_recode(aluetyyppi,
'Muu maaseutu' = "Ydinmaaseutu",
'Muu maaseutu' = "Harvaan asuttu maaseutu"),
aluetyyppi = ggptt::line_wrap(aluetyyppi, 25)) %>%
group_by(time, aluetyyppi) %>%
summarise_all(sum) %>%
ungroup() %>%
gather(vars, values, -time, -aluetyyppi) %>%
ggplot(aes(time, values, colour = vars)) +
facet_wrap( ~ aluetyyppi) +
geom_line() +
geom_h0() +
# scale_colour_manual(values = atyyppi_colour) +
the_title_blank(c("x", "l")) +
labs(subtitle = glue("Työperäinen muutto on samana vuonna asuin- ja työpaikan kuntaan vaihtaneiden muutto."),
title = glue("Nettomuutto ja työperäinen nettomuutto {time_range[1]}-{time_range[2]}/{no_century(time_range2[2])}"),
caption = "Lähde: PTT, Tilastokeskus",
y = "henkeä")
?theme
theme_update(plot.subtitle = element_text(colour = "grey30", size = 18),
plot.title = element_text(colour = "grey30", size = 40),
plot.margin = margin(0.5, 0.5, 3, 0.5),
legend.spacing = 2)
k <- theme_ptt()
k
?unit
theme_update(plot.subtitle = element_text(colour = "grey30", size = 18),
plot.title = element_text(colour = "grey30", size = 40),
plot.margin = margin(0.5, 0.5, 3, 0.5),
legend.spacing = unit(16, "px"))
theme_update(plot.subtitle = element_text(colour = "grey30", size = 18),
plot.title = element_text(colour = "grey30", size = 40),
plot.margin = margin(0.5, 0.5, 3, 0.5),
legend.spacing = unit(16, "pt"))
theme_update(plot.subtitle = element_text(colour = "grey30", size = 18),
plot.title = element_text(colour = "grey30", size = 40),
plot.margin = margin(0.5, 0.5, 3, 0.5),
legend.spacing = unit(24, "pt"))
dat_matkat_aluokka %>%
gather(vars, values, tyomatka_asuin, tyomatka_tyo) %>%
mutate(vars = fct_recode(vars,
"Asuinpaikan mukaan" = "tyomatka_asuin",
"Työpaikan mukaan" = "tyomatka_tyo")) %>%
ggplot(aes(time, values, colour = aluokka)) +
facet_wrap(~ vars) +
geom_line() +
geom_h0() +
scale_colour_manual(values = atyyppi_colour) +
scale_x_continuous(labels = no_century) +
labs(title = "Keskimääräiset työmatkat",
subtitle = "Ruutuaineistosta kaupunki-maaseutuluokituksella",
caption = "© YKR / SYKE ja TK 2018",
y = "km") +
the_title_blank(c("x", "l"))
# ggsave("matkat.png", height = 8, width = 16)
dat_sum_amma3 %>%
mutate(amma3 = replace_na(as.character(amma3), "Muut")) %>%
mutate(amma_val = fct_recode(amma3,
'Erityisasiantuntijat' = "erityisasiantuntijat",
'Asiantuntijat' = "asiantuntijat",
'Valmistus ja prosessi' = "korj & valm tt",
'Valmistus ja prosessi' = "pros tt",
'Toimisto ja myynti' =  "tsto & aspal tt",
'Toimisto ja myynti' =  "pal, myynti & hoito tt",
'Rakennus' = "rakennus tt"),
amma_val = fct_other(amma_val, keep = c('Erityisasiantuntijat', 'Asiantuntijat',
'Valmistus ja prosessi', 'Toimisto ja myynti', 'Rakennus'),
other_level = "Muut"),
aluetyyppi_tp = fct_rev(aluetyyppi_tp)) %>%
group_by(time, aluetyyppi, aluetyyppi_tp, amma_val) %>%
summarise(N = sum(N)) %>%
group_by(time, aluetyyppi_tp, amma_val) %>%
summarise(pend_osuus = 100 * sum(N[!(aluetyyppi == aluetyyppi_tp)], na.rm = TRUE) / sum(N, na.rm = TRUE)) %>%
group_by(aluetyyppi_tp, amma_val) %>%
summarise(pend_osuus_muutos = (pend_osuus[time == max(time)] - pend_osuus[time == 2000])) %>%
ungroup() %>%
filter(amma_val != "Muut") %>%
ggplot(aes(aluetyyppi_tp, pend_osuus_muutos)) +
facet_wrap(~ amma_val, nrow = 1) +
geom_col() +
geom_hline(yintercept = 0) +
coord_flip() +
labs(y = "%-yksikköä", x = NULL,
title = "Muista kunnista työssäkäyvien osuuden muutos 2000-2015 ammateittain alueilla keskimäärin")
